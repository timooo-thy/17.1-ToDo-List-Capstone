<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Work List</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9" crossorigin="anonymous">
    <link href="/styles.css" rel="stylesheet">
  </head>
  <body data-page-id="work">
    <nav class="navbar nav-bar navbar-expand-lg">
        <div class="container-fluid my-2">
          <a class="navbar-brand mx-4" href="/">ToDo Tracker</a>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
          </button>
          <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav me-auto mb-2 mb-lg-0">
              <li class="nav-item mx-4">
                <a class="nav-link" aria-current="page" href="/daily">Daily Tasks</a>
              </li>
              <li class="nav-item mx-4">
                <a class="nav-link active" href="/work">Work Tasks</a>
              </li>
              </li>
            </ul>
          </div>
        </div>
    </nav>
      <div class="datebox text-center mt-5">
        <h4><%= currentDateTime %></h4>
      </div>
      <div class="container d-flex justify-content-center mt-5">
        <div class="col-md-6">
            <ul class="list-group">
                <% if(locals.todolist){%>
                    <% for(let i = 0; i < todolist.length; i++) { %>
                        <li class="list-group-item d-flex justify-content-between align-items-center py-5">
                            <span class="list""><%= todolist[i] %></span>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="todoCheck<%= i %>" onclick="toggleStrikeout(this)">
                                <label class="form-check-label" for="todoCheck<%= i %>"></label>
                            </div>
                        </li>
                    <% } %>
                <% } %>
                    <form action="/work/submit" method="post">
                        <div class="row position-relative"> <!-- Add position-relative for positioning context -->
                            <div class="col-md-12"> <!-- Set to 12 columns for full width -->
                                <input type="text" class="form-control form" id="todo" name="todo" placeholder="Enter your todo item" required>
                                <button type="submit" class="button position-absolute top-50 end-0 translate-middle">+</button> <!-- Positioning classes added -->
                            </div>
                        </div>
                    </form>
                </li>
            </ul>
        </div>   
    </div>

    <footer class="mt-5 text-center">
      <p id="footerYear">Â©Timothy Lee </p>
    </footer>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-HwwvtgBNo3bZJJLYd8oVXjrBZt8cqVSpeBNS5n7C8IVInixGAoxmnlMuBnhbgrkm" crossorigin="anonymous"></script>
    <script>
			function toggleStrikeout(checkbox) {
				const listItem = checkbox.closest('.list-group-item');
				const checkboxId = checkbox.id;
				const pageId = document.body.getAttribute('data-page-id');
				
				if (checkbox.checked) {
						listItem.classList.add('strikeout');
						localStorage.setItem(pageId + '-' + checkboxId, 'checked');
				} else {
						listItem.classList.remove('strikeout');
						localStorage.removeItem(pageId + '-' + checkboxId);
				}
			}

			function loadCheckboxStates() {
				const checkboxes = document.querySelectorAll('.form-check-input');
				const pageId = document.body.getAttribute('data-page-id');

				checkboxes.forEach(checkbox => {
					const checkboxId = checkbox.id;
					if (localStorage.getItem(pageId + '-' + checkboxId) === 'checked'){
						checkbox.checked = true;
						checkbox.closest('.list-group-item').classList.add('strikeout');
					}
				});
			}

			function getYear() {
				const date = new Date();
				return date.getFullYear();
			}
      document.getElementById("footerYear").textContent += getYear();
			window.onload = loadCheckboxStates;
    </script>
  </body>
</html>